# 🧠 詳細診断AIモジュール 要件定義・完全プロンプト（MVP版）

## 概要

本モジュールは、ユーザーの回答から **MBTIタイプ（16分類）** と **Big Fiveパーソナリティ特性（OCEAN）** を推定し、
その結果をもとに **性格を反映したオリジナルストーリー** を生成することを目的とする。
生成AIは外部APIを使わず、ローカルで動作する **@xenova/transformers（既定: Xenova/Qwen2.5-0.5B-Instruct）** を使用。

---

## 🧩 構成概要

| セクション | 内容                              | 設問数           | 主目的                       |
| ---------- | --------------------------------- | ---------------- | ---------------------------- |
| A          | MBTI 軸診断（E/I, S/N, T/F, J/P） | 8問              | タイプ16分類の基礎判定       |
| B          | Big Five 診断（OCEAN）            | 20問             | 精神特性の5次元スコア化      |
| C          | 補助・自由記述                    | 2問＋自由記述1問 | 適応性・価値観・物語生成素材 |
| **合計**   |                                   | **30問**         |                              |

---

## 🧠 MBTIセクション設問（A1–A8）

| ID  | 質問文                                               | 軸        | E/I(+正はE, −はI) | S/N(+正はN, −はS) | T/F(+正はT, −はF) | J/P(+正はJ, −はP) | 重み |
| --- | ---------------------------------------------------- | --------- | ----------------- | ----------------- | ----------------- | ----------------- | ---- |
| A1  | 社交の場で、まず自分から話しかけることが多いですか？ | 外向/内向 | +1                |                   |                   |                   | 1.0  |
| A2  | 情報を得るとき、五感を重視しますか？（直感よりも）   | 感覚/直観 |                   | −1                |                   |                   | 1.0  |
| A3  | 意思決定をするとき、論理を優先しますか？             | 思考/感情 |                   |                   | +1                |                   | 1.0  |
| A4  | 計画を立てて進める方が安心ですか？                   | 判断/知覚 |                   |                   |                   | +1                | 1.0  |
| A5  | 新しい人に会ったとき、すぐ話しかけますか？           | 外向/内向 | +1                |                   |                   |                   | 0.8  |
| A6  | 抽象的な意味を想像する方ですか？                     | 感覚/直観 |                   | +1                |                   |                   | 0.8  |
| A7  | 他人の悩みを聞いたとき、解決策を考える方ですか？     | 思考/感情 |                   |                   | +1                |                   | 0.8  |
| A8  | 締め切り前に計画的に動く方ですか？                   | 判断/知覚 |                   |                   |                   | +1                | 0.8  |

**MBTI計算方法：**

- 各軸ごとにスコア平均を取り、正なら前者、負なら後者を採用。
    - E/I：A1, A5
    - S/N：A2, A6
    - T/F：A3, A7
    - J/P：A4, A8

- 結果例：「INTP」「ESFJ」など16タイプ分類。

---

## 🔬 Big Fiveセクション設問（B9–B28）

| 軸                    | 質問ID | 質問文（要約）               | 重み |
| --------------------- | ------ | ---------------------------- | ---- |
| **Openness**          | B9     | 新しいアイデアにワクワクする | 1.0  |
|                       | B10    | 芸術・音楽などに感受性が高い | 0.8  |
|                       | B11    | 抽象的議論を好む             | 1.0  |
|                       | B12    | 未知の環境に魅力を感じる     | 1.0  |
| **Conscientiousness** | B13    | 時間通りに行動する           | 1.0  |
|                       | B14    | 細部まで注意を払う           | 1.0  |
|                       | B15    | 自分の目標を守る             | 0.8  |
|                       | B16    | 「今やる」傾向がある         | 1.0  |
| **Extraversion**      | B17    | 大人数でエネルギーを得る     | 1.0  |
|                       | B18    | 会話でリードすることが多い   | 1.0  |
|                       | B19    | 初対面に抵抗が少ない         | 0.8  |
|                       | B20    | 活動的時間に満たされる       | 1.0  |
| **Agreeableness**     | B21    | 困っている人を助けたくなる   | 1.0  |
|                       | B22    | 協力を重んじる               | 1.0  |
|                       | B23    | 他人の気持ちを考慮する       | 1.0  |
|                       | B24    | 平和的関係を保ちたい         | 0.8  |
| **Neuroticism**       | B25    | 小さなことで落ち込みやすい   | 1.0  |
|                       | B26    | 自分を立て直すのが難しい     | 1.0  |
|                       | B27    | 心配が頭から離れない         | 0.8  |
|                       | B28    | 感情がコントロールできない   | 1.0  |

**スコア計算方法：**
各設問は 1〜5 の Likert スケールで回答。

- 軸スコア ＝ (Σ 各設問スコア × 重み) ÷ (Σ 重み)
- 結果を 0〜1 スケールに正規化。

例：

```python
O = weighted_average([B9,B10,B11,B12])
C = weighted_average([B13,B14,B15,B16])
E = weighted_average([B17,B18,B19,B20])
A = weighted_average([B21,B22,B23,B24])
N = weighted_average([B25,B26,B27,B28])
```

---

## ⚙️ 補助セクション（C29–C31）

| ID  | 質問文                             | 用途               |
| --- | ---------------------------------- | ------------------ |
| C29 | 環境変化時の行動傾向               | 適応性評価         |
| C30 | 価値観衝突時の優先傾向             | 判断軸補足         |
| C31 | 【自由記述】自分らしさを感じた場面 | ストーリー生成素材 |

---

## 🧮 出力仕様（AI出力設計）

### 1️⃣ 診断結果JSON例

```json
{
    "mbti": "INTP",
    "bigfive": {
        "openness": 0.72,
        "conscientiousness": 0.41,
        "extraversion": 0.36,
        "agreeableness": 0.67,
        "neuroticism": 0.55
    },
    "adaptive_trait": 0.68,
    "value_conflict_bias": "rational",
    "free_description": "私は少人数で深い話をする時に一番自分らしい..."
}
```

### 2️⃣ レポート生成仕様（AI生成）

AIに次のプロンプトを渡す：

> あなたは心理カウンセラーAIです。以下のユーザー診断データに基づき、
>
> 1. 性格タイプ（MBTI）とBig Five 特性を総合的に説明し、
> 2. 強み・弱み・思考パターンを200文字程度でまとめ、
> 3. その人らしい短い人生ストーリー（500〜700文字）を創作してください。
>    JSON形式で返してください。
>
> **入力データ:**
>
> ```json
> {ユーザー診断データ}
> ```

---

## 🧠 生成AI利用ポリシー

- **ローカルモデル:**
    - @xenova/transformers 経由の `Xenova/Qwen2.5-0.5B-Instruct`（既定）
    - 環境変数 `LLM_MODEL` で差し替え可能

- **データ保持:** 匿名・非個人特定
- **倫理:** 臨床心理診断・医療用途ではない旨を明記

---

## 📦 コーディング時指示

- 入力UI：React + Next.js でフォーム実装（30問）
- 設問は `GET /api/questions/detail` から取得
- 回答データを `POST /api/diagnose/detail?sessionId=...` に送信（MBTI/Big Five/ストーリーを一括生成）
- サーバーは Next.js API Routes 上でローカル推論（@xenova/transformers）を実行
- 出力をダッシュボードで可視化（レーダーチャート＋ストーリー表示）

---

## ✅ 想定MVP要件

- 質問回答 → 診断結果算出 → 性格レポート生成 → ストーリー提示
- ローカル推論（@xenova/transformers, 既定: Qwen2.5-0.5B-Instruct）を利用
- Vercel等のNodeランタイムで稼働可（SQLiteは任意、なければインメモリ）
