# 🧩 要件定義書（MVP版）

## 1. プロジェクト概要

| 項目           | 内容                                                                                                                       |
| -------------- | -------------------------------------------------------------------------------------------------------------------------- |
| プロジェクト名 | 会話式 MBTI＋ストーリーテスト（仮称：「AI Personality Story」）                                                            |
| 開発目的       | ユーザーがAIとの自然な会話を通じて自己理解を深め、自分の性格タイプとその物語的表現を得られる体験を提供する。               |
| コンセプト     | 「性格診断を“読む”のではなく、“語り合って物語る”」                                                                         |
| 位置づけ       | エンタメ・自己理解支援系Webアプリ（非臨床・非医療）                                                                        |
| 対象ユーザー   | ・自己理解に興味のある20〜40代<br>・MBTI診断など心理系コンテンツが好きな層<br>・就活・恋愛・創作など自己分析ニーズがある人 |

---

## 2. MVPで実装する範囲

| カテゴリ           | 実装対象                                        | 備考                                |
| ------------------ | ----------------------------------------------- | ----------------------------------- |
| **UI/UX**          | チャット形式の対話画面                          | シンプルなチャットUI（ユーザー⇄AI） |
| **質問フェーズ**   | MBTIの4軸（E/I, S/N, T/F, J/P）ごとに1問ずつ    | 合計4〜5ラウンドのやり取り          |
| **AI応答**         | ユーザー回答に対して1回深掘り質問＋要約コメント | LLMで生成                           |
| **MBTI推定**       | AIが会話内容から4軸を推定し、タイプを返す       | JSON構造で保持                      |
| **ストーリー生成** | AIがユーザーのタイプをもとに短い物語を生成      | 日本語400〜600文字程度              |
| **結果画面**       | MBTIタイプ＋特徴＋ストーリーを表示              | シェアボタン（ダミーでOK）          |
| **ログ保存**       | 会話履歴・結果をSQLiteに保存                    | MVPではセッション単位保存で十分     |
| **免責表示**       | 「心理診断・医療診断ではありません」            | フッターまたは結果画面に記載        |

---

## 3. 非機能要件（MVP想定）

| 項目                 | 要件                                                                        |
| -------------------- | --------------------------------------------------------------------------- |
| **パフォーマンス**   | 1セッションあたり5問以内、レスポンス3〜5秒以内（CPU推論可）                 |
| **スケーラビリティ** | 単一ユーザー同時利用想定。PoC段階では負荷試験不要。                         |
| **セキュリティ**     | ユーザー入力内容はDBに平文で保存しない（暗号化orハッシュ化）。              |
| **プライバシー**     | 同意文を明示。「会話内容は診断目的以外に使用しません。」                    |
| **多言語対応**       | MVPでは日本語のみ。                                                         |
| **アクセシビリティ** | シンプルなテキストUI、PC・スマホ対応。                                      |
| **ライセンス・法務** | 外部有料API不要のローカル推論（@xenova/transformers, 例: Qwen2.5-0.5B）を使用 |

---

## 4. システム構成（MVP）

```
[User Browser]
     ↓
(Next.js App Router UI)
     ↓ (API fetch)
[Next.js API Routes]
     ├── セッション管理（/api/session）
     ├── 簡易診断チャット（/api/chat）
     ├── 詳細設問取得（/api/questions/detail）
     ├── 詳細診断・結果生成（/api/diagnose/detail）
     └── 結果取得（/api/result）

[ローカル推論]
  └── @xenova/transformers（既定: Xenova/Qwen2.5-0.5B-Instruct）
```

| コンポーネント | 技術                                  | 役割                          |
| -------------- | ------------------------------------- | ----------------------------- |
| フロント       | Next.js + TailwindCSS                 | チャットUI、結果画面          |
| バックエンド   | Next.js API Routes                    | MBTI/Big Five 推定・生成処理  |
| AIモデル       | @xenova/transformers（Qwen2.5-0.5B等）| ローカルでの対話＋生成        |
| DB             | SQLite（better-sqlite3）              | 会話履歴・結果保存（任意）     |
| デプロイ       | Vercel 等（Node ランタイム必須）      | SQLiteなしでも動作可           |

---

## 5. 機能要件（詳細）

### ① 会話・質問機能

- AIがMBTIの4軸（E/I, S/N, T/F, J/P）ごとに質問。
- 各回答に対してAIが簡単な深掘り質問。
- 対話は最大5往復で終了。

### ② MBTI推定機能

- FastAPIが全会話をまとめ、AIにプロンプトで軸判定を依頼。
- 出力フォーマット：

    ```json
    {
        "E/I": "I",
        "S/N": "N",
        "T/F": "F",
        "J/P": "P"
    }
    ```

- MBTIタイプを結合して表示（例：INFP）。

### ③ ストーリー生成機能

- 推定MBTIをもとにAIが物語を生成。
- テーマ例：「森の中での選択」「未来都市の会話」「旅の仲間との別れ」など。
- 生成結果は400〜600文字程度。

### ④ 結果表示

- MBTIタイプ（例：INFP）＋タイトル（例：「理想を追う詩人」）
- 簡単な性格説明
- ストーリー本文
- 「もう一度試す」ボタン

---

## 6. データ項目（MVP想定）

| データ           | 保存内容                         |
| ---------------- | -------------------------------- |
| user_session     | UUID, start_time, end_time       |
| conversation_log | 質問, 回答, 時刻                 |
| mbti_result      | 各軸, タイプ, ストーリーテキスト |

---

## 7. 想定プロンプト設計（例）

### MBTI推定プロンプト

```
あなたは心理分析アシスタントです。
以下の会話記録から、ユーザーのMBTIを推定してください。

会話記録：
{conversation}

各軸(E/I, S/N, T/F, J/P)を1つずつ判定し、簡単な理由をつけてJSONで出力してください。
```

### ストーリー生成プロンプト

```
あなたはストーリーテラーAIです。
ユーザーの性格タイプは {mbti} です。
このタイプを象徴する短編物語を作ってください。
テーマ：自己発見と成長、日本語400〜600文字。
```

---

## 8. 今後の拡張予定（MVP以降）

| フェーズ | 追加機能                                     |
| -------- | -------------------------------------------- |
| Phase 2  | 回答履歴に基づく「詳細分析グラフ」           |
| Phase 3  | 継続利用ユーザー向け「性格変化トラッキング」 |
| Phase 4  | SNS連携（MBTIタイプ共有）・AIバディ診断      |
| Phase 5  | 音声入力・多言語対応・個別テーマ分析         |

---

## 9. 成功指標（MVP段階）

| 指標                 | 目標値                                  |
| -------------------- | --------------------------------------- |
| 平均セッション完了率 | 70%以上                                 |
| 平均対話数           | 4〜5往復                                |
| ストーリー生成成功率 | 95%以上                                 |
| 平均処理時間         | 5秒以内（CPU）                          |
| ユーザー満足コメント | 60%以上が「面白い」「もう一度やりたい」 |

---

## 10. リスク・留意点

| リスク                   | 対策                                     |
| ------------------------ | ---------------------------------------- |
| AI回答の一貫性不足       | MBTI軸ごとにプロンプト強化＋温度低め設定 |
| 会話中断やセッション切れ | 自動セーブ機能／セッションUUID管理       |
| プライバシー懸念         | ローカル保存・匿名利用・免責表示         |
| 誤診・誤解リスク         | 医療診断でない旨を明記                   |
| API遅延                  | 軽量モデル or CPU最適化モデル利用        |

---
